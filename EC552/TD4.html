<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TD4 : Manipulations de data-frames avec dplyr – EC552 : Introduction au langage R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b512256bc363577b27543e003c495f0c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./TD4.html">TD4 : Manipulations de data-frames avec <code>dplyr</code></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">EC552 : Introduction au langage R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TD1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TD1 : Premiers pas dans R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TD2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TD2 : Les matrices</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TD3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TD3 : Les data-frames</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TD4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">TD4 : Manipulations de data-frames avec <code>dplyr</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TD5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TD5 : Graphiques avec <code>ggplot2</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TD6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TD6 : Programmer sur R</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#les-packages-dplyr-et-tidyverse" id="toc-les-packages-dplyr-et-tidyverse" class="nav-link active" data-scroll-target="#les-packages-dplyr-et-tidyverse"><span class="header-section-number">1</span> Les packages <code>dplyr</code> et <code>tidyverse</code></a></li>
  <li><a href="#le-format-tibble" id="toc-le-format-tibble" class="nav-link" data-scroll-target="#le-format-tibble"><span class="header-section-number">2</span> Le format <code>tibble</code></a></li>
  <li><a href="#le-pipe" id="toc-le-pipe" class="nav-link" data-scroll-target="#le-pipe"><span class="header-section-number">3</span> Le “pipe”</a>
  <ul class="collapse">
  <li><a href="#un-exemple" id="toc-un-exemple" class="nav-link" data-scroll-target="#un-exemple"><span class="header-section-number">3.1</span> Un exemple</a></li>
  <li><a href="#un-exercice" id="toc-un-exercice" class="nav-link" data-scroll-target="#un-exercice"><span class="header-section-number">3.2</span> Un exercice</a></li>
  </ul></li>
  <li><a href="#quelques-fonctions-utiles" id="toc-quelques-fonctions-utiles" class="nav-link" data-scroll-target="#quelques-fonctions-utiles"><span class="header-section-number">4</span> Quelques fonctions utiles</a>
  <ul class="collapse">
  <li><a href="#la-fonction-mutate" id="toc-la-fonction-mutate" class="nav-link" data-scroll-target="#la-fonction-mutate"><span class="header-section-number">4.1</span> La fonction <code>mutate()</code></a></li>
  <li><a href="#les-fonctions-group_by-et-summarise" id="toc-les-fonctions-group_by-et-summarise" class="nav-link" data-scroll-target="#les-fonctions-group_by-et-summarise"><span class="header-section-number">4.2</span> Les fonctions <code>group_by()</code> et <code>summarise()</code></a></li>
  </ul></li>
  <li><a href="#nettoyage-des-données" id="toc-nettoyage-des-données" class="nav-link" data-scroll-target="#nettoyage-des-données"><span class="header-section-number">5</span> Nettoyage des données</a>
  <ul class="collapse">
  <li><a href="#un-exemple-1" id="toc-un-exemple-1" class="nav-link" data-scroll-target="#un-exemple-1"><span class="header-section-number">5.1</span> Un exemple</a>
  <ul class="collapse">
  <li><a href="#séparer-les-colonnes-avec-separate" id="toc-séparer-les-colonnes-avec-separate" class="nav-link" data-scroll-target="#séparer-les-colonnes-avec-separate">Séparer les colonnes avec <code>separate()</code></a></li>
  <li><a href="#rassembler-les-colonnes-avec-pivot_longer" id="toc-rassembler-les-colonnes-avec-pivot_longer" class="nav-link" data-scroll-target="#rassembler-les-colonnes-avec-pivot_longer">Rassembler les colonnes avec <code>pivot_longer()</code></a></li>
  </ul></li>
  <li><a href="#un-exercice-1" id="toc-un-exercice-1" class="nav-link" data-scroll-target="#un-exercice-1"><span class="header-section-number">5.2</span> Un exercice</a></li>
  </ul></li>
  <li><a href="#traitement-des-données-manquantes" id="toc-traitement-des-données-manquantes" class="nav-link" data-scroll-target="#traitement-des-données-manquantes"><span class="header-section-number">6</span> Traitement des données manquantes</a>
  <ul class="collapse">
  <li><a href="#compléter-un-data-frame-avec-complete" id="toc-compléter-un-data-frame-avec-complete" class="nav-link" data-scroll-target="#compléter-un-data-frame-avec-complete"><span class="header-section-number">6.1</span> Compléter un data-frame avec <code>complete()</code></a></li>
  <li><a href="#remplacer-les-na-avec-replace_na" id="toc-remplacer-les-na-avec-replace_na" class="nav-link" data-scroll-target="#remplacer-les-na-avec-replace_na"><span class="header-section-number">6.2</span> Remplacer les <code>NA</code> avec <code>replace_na()</code></a></li>
  </ul></li>
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices"><span class="header-section-number">7</span> Exercices</a>
  <ul class="collapse">
  <li><a href="#exercice-1" id="toc-exercice-1" class="nav-link" data-scroll-target="#exercice-1"><span class="header-section-number">7.1</span> Exercice 1</a></li>
  <li><a href="#exercice-2" id="toc-exercice-2" class="nav-link" data-scroll-target="#exercice-2"><span class="header-section-number">7.2</span> Exercice 2</a></li>
  <li><a href="#exercice-3" id="toc-exercice-3" class="nav-link" data-scroll-target="#exercice-3"><span class="header-section-number">7.3</span> Exercice 3</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TD4 : Manipulations de data-frames avec <code>dplyr</code></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="les-packages-dplyr-et-tidyverse" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Les packages <code>dplyr</code> et <code>tidyverse</code></h1>
<ul>
<li><p>Le package <code>dplyr</code> permet de manipuler facilement les données, notamment les data-frames.</p></li>
<li><p>Il fait partie de l’ensemble de packages <code>tidyverse</code>, regroupant également le package <code>ggplot2</code>. Ce dernier permet de réaliser des graphiques sophistiqués à l’esthétique soignée <em>(voir TD5)</em>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="le-format-tibble" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Le format <code>tibble</code></h1>
<ul>
<li>Il s’agit là d’une version plus moderne du format <code>data.frame</code>. N’importe quel data-frame peut naturellement être converti en format <code>tibble</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"iris"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(iris)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>iris_tibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(iris)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(iris_tibble)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<ul>
<li>La création d’un <code>tibble</code> se fait assez naturellement :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Notes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Nom"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Alice"</span>,<span class="st">"Bob"</span>,<span class="st">"Charles"</span>),</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Notes"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">8</span>,<span class="dv">9</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Contrairement au format <code>data.frame</code>, l’extraction d’une colonne ne renvoie pas un vecteur, mais un <code>tibble</code> :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Notes[,<span class="st">"Notes"</span>])</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
</section>
<section id="le-pipe" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Le “pipe”</h1>
<ul>
<li><p>Il s’agit de la commande <code>%&gt;%</code>, qui ouvre un canal d’instructions séquentielles.</p></li>
<li><p>Le pipe est notamment utilisé pour effectuer une sucession d’instructions données, en particulier afin de manipuler les données.</p></li>
</ul>
<section id="un-exemple" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="un-exemple"><span class="header-section-number">3.1</span> Un exemple</h2>
<ul>
<li>Utilisons le jeu de données <code>diamonds</code>, dont on affiche ici les premières lignes.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"diamonds"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diamonds)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  carat cut       color clarity depth table price     x     y     z
  &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48</code></pre>
</div>
</div>
<ul>
<li>Supposons que l’on souhaite calculer le prix moyen des diamants dont la coupe satisfait <code>cut==Good</code> et la couleur satisfait <code>color=="E"</code>.</li>
</ul>
<p>On peut effectuer la succession d’instructions suivante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cond <span class="ot">&lt;-</span> diamonds<span class="sc">$</span>cut <span class="sc">==</span> <span class="st">"Good"</span> <span class="sc">&amp;</span> diamonds<span class="sc">$</span>color <span class="sc">==</span> <span class="st">"E"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sub_diamonds <span class="ot">&lt;-</span> diamonds[cond,]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sub_diamonds<span class="sc">$</span>price)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3423.644</code></pre>
</div>
</div>
<p>Ce qui peut aussi s’écrire en une ligne :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(diamonds[diamonds<span class="sc">$</span>cut<span class="sc">==</span><span class="st">"Good"</span> <span class="sc">&amp;</span> diamonds<span class="sc">$</span>color<span class="sc">==</span><span class="st">"E"</span>,]<span class="sc">$</span>price)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3423.644</code></pre>
</div>
</div>
<ul>
<li>Le “pipe” permet d’effectuer cette succesion d’instruction de façon plus lisible en utilisant les fonctions <code>filter()</code> et <code>select()</code> du package <code>dplyr</code> :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cut <span class="sc">==</span> <span class="st">"Good"</span> <span class="sc">&amp;</span> color <span class="sc">==</span> <span class="st">"E"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(price) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3423.644</code></pre>
</div>
</div>
<ul>
<li>En résumé, pour une fonction <code>f()</code> :
<ul>
<li><code>x %&gt;% f()</code> est équivalent à <code>f(x)</code>;</li>
<li><code>x %&gt;% f(y)</code>est équivalent à <code>f(x,y)</code>.</li>
</ul></li>
</ul>
</section>
<section id="un-exercice" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="un-exercice"><span class="header-section-number">3.2</span> Un exercice</h2>
<p>En utilisant les fonctions <code>select()</code>, <code>filter()</code>, et <code>rename()</code>, créer un nouveau data-frame issu de <code>diamonds</code> ne contenant que les diamants dont le carat est supérieur à 0.5, la coupe égale à “Premium” et la couleur égale à “D”. On ne conservera que les colonnes <em>carat</em> et <em>price</em>, et on renommera les colonnes en Français.</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>diamonds_small <span class="ot">&lt;-</span> diamonds <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(carat <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> cut<span class="sc">==</span><span class="st">"Premium"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(carat,price) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Carat=</span>carat,<span class="at">Prix=</span>price)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="quelques-fonctions-utiles" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Quelques fonctions utiles</h1>
<section id="la-fonction-mutate" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="la-fonction-mutate"><span class="header-section-number">4.1</span> La fonction <code>mutate()</code></h2>
<ul>
<li><p>Elle permet de définir de nouvelles colonnes (<em>ou de modifier des colonnes existantes</em>) dans un data-frame, qui seront le résultat d’un calcul.</p></li>
<li><p>Par exemple dans le data-frame <code>mtcars</code>, la consommation des voitures est exprimée en <em>mpg</em> (miles per galon). Si on veut l’exprimer en <em>L/100km</em>, alors on utilise <em>L/100 km</em> = <em>282.48/mpg</em> :</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>mtcars <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"L/100km"</span> <span class="ot">=</span> <span class="fl">282.48</span><span class="sc">/</span>mpg) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="les-fonctions-group_by-et-summarise" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="les-fonctions-group_by-et-summarise"><span class="header-section-number">4.2</span> Les fonctions <code>group_by()</code> et <code>summarise()</code></h2>
<ul>
<li><p>De façon régulière, on est amené à calculer certaines statistiques dépendant de groupes. La fonction <code>group_by()</code> permet ce regroupement.</p></li>
<li><p>La fonction <code>summarise()</code> permet quant à elle de créer un <code>tibble</code> à partir des opérations effectuées.</p></li>
</ul>
<p><strong><em>Exemple</em></strong></p>
<p>A partir du data-frame <code>mtcars</code>, on souhaite calculer la consommation moyenne des véhicules ainsi que l’écart-type de ces consommations, en fonction de la cylindrée et du mode de transmission des véhicules.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl,am) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">M =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">L/100km</span><span class="st">`</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">SD =</span> <span class="fu">sd</span>(<span class="st">`</span><span class="at">L/100km</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cyl'. You can override using the `.groups`
argument.</code></pre>
</div>
</div>
<p><strong><em>Remarque :</em></strong> Il est important de “dégrouper” le <code>tibble</code> une fois les manipulations effectuées avec la fonction <code>ungroup()</code>. Dans le cas contraire, tous les calculs suivants effectués sur le <code>tibble</code> se feraient selon les groupes effectués.</p>
<p><strong><em>Exercice</em></strong></p>
<p>A partir du jeu de données <code>diamonds</code> :</p>
<ol type="1">
<li>Renommer les variables <em>x</em>, <em>y</em> et <em>z</em> par <em>length</em>, <em>width</em> et <em>height</em>;</li>
<li>Convertir ces valeurs en cm, et non en mm;</li>
<li>Créer un objet <code>diamonds_modif</code> contenant ces trois colonnes ainsi que les colonnes <em>color</em>, <em>cut</em>, <em>carat</em> et <em>price</em>, où l’on ne conserve que les découpes <em>Premium</em> ou <em>Ideal</em>.</li>
<li>Pour chaque combinaison <em>cut/color</em>, calculer la moyenne des trois variables <em>length</em>, <em>width</em> et <em>height</em>. Stocker ce résumé dans un objet <code>diam_summary</code>.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>diamonds_modif <span class="ot">&lt;-</span> diamonds <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">length=</span>x,<span class="at">width=</span>y,<span class="at">height=</span>z) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> length<span class="sc">/</span><span class="dv">10</span>,<span class="at">width=</span>width<span class="sc">/</span><span class="dv">10</span>,<span class="at">height=</span>height<span class="sc">/</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(height,width,length,color,cut,carat,price) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cut<span class="sc">==</span><span class="st">"Premium"</span> <span class="sc">|</span> cut<span class="sc">==</span><span class="st">"Ideal"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>diam_summary <span class="ot">&lt;-</span> diamonds_modif <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cut,color) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_length =</span> <span class="fu">mean</span>(length),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_width =</span> <span class="fu">mean</span>(width),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_height =</span> <span class="fu">mean</span>(height)) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="nettoyage-des-données" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Nettoyage des données</h1>
<p>Un jeu de données peut être considéré comme “propre” s’il satisfait les 3 règles suivantes :</p>
<ul>
<li>chaque variable possède sa propre colonne ;</li>
<li>chaque observation possède sa propre ligne ;</li>
<li>chaque valeur possède sa propre cellule.</li>
</ul>
<section id="un-exemple-1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="un-exemple-1"><span class="header-section-number">5.1</span> Un exemple</h2>
<p>Considérons le jeu de données ci-dessous.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>grades <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name =</span> <span class="fu">c</span>(<span class="st">"Tommy"</span>, <span class="st">"Mary"</span>, <span class="st">"Gary"</span>, <span class="st">"Cathy"</span>),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sex_Age =</span> <span class="fu">c</span>(<span class="st">"m_15"</span>, <span class="st">"f_15"</span>, <span class="st">"m_16"</span>, <span class="st">"f_14"</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Test1 =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">14</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Test2 =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">10</span>, <span class="dv">12</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Test3 =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">17</span>, <span class="dv">10</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce jeu de données n’est pas “propre”. La colonne <code>Sex_Age</code> réunit deux variables. D’autre part, il y a trois colonnes <em>tests</em>, ce qui peut être le résultat souhaité, mais on pourrait aussi vouloir une variable <em>Grade</em> donnant la note obtenue, dépendant du test effectué.</p>
<section id="séparer-les-colonnes-avec-separate" class="level3">
<h3 class="anchored" data-anchor-id="séparer-les-colonnes-avec-separate">Séparer les colonnes avec <code>separate()</code></h3>
<p>La colonne Sex_Age doit être séparée en deux.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>grades_s_a <span class="ot">&lt;-</span> grades <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col=</span>Sex_Age,<span class="at">into=</span><span class="fu">c</span>(<span class="st">"Sex"</span>,<span class="st">"Age"</span>),<span class="at">sep=</span><span class="st">"_"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Remarque :</em></strong> l’inverse de la fonction <code>separate()</code>est la fonction <code>unite()</code>.</p>
</section>
<section id="rassembler-les-colonnes-avec-pivot_longer" class="level3">
<h3 class="anchored" data-anchor-id="rassembler-les-colonnes-avec-pivot_longer">Rassembler les colonnes avec <code>pivot_longer()</code></h3>
<p>Supposons que la variable d’intérêt soit la note obtenue aux différents contrôles.</p>
<p>Dans <code>grades_s_a</code>, cette variable est encodée dans trois colonnes. On préfère ici les rassembler en une seule colonne, et spécifier le numéro du test dans une autre colonne. Le jeu de données obtenu aura alors un format plus long, mais qui sera peut-être plus adapté à nos besoins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>grades_long <span class="ot">&lt;-</span> grades_s_a <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">starts_with</span>(<span class="st">"Test"</span>), <span class="co"># On sélectionne les colonnes à assembler</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Test"</span>,        <span class="co"># Nom de la colonne rassemblant les anciens noms</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Grade"</span>)      <span class="co"># Nom de la collone rassemblant les valeurs</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Remarque :</em></strong> l’inverse de la fonction <code>pivot_longer()</code>est <code>pivot_wider()</code>.</p>
<p>Un format plus long comme obtenu précédemment est souvent plus adapté pour résumer les données. Par exemple, si on veut la moyenne des notes obtenues par test et pour chaque sexe :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>grades_summary <span class="ot">&lt;-</span> grades_long <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sex,Test) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Grade)) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Sex'. You can override using the `.groups`
argument.</code></pre>
</div>
</div>
</section>
</section>
<section id="un-exercice-1" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="un-exercice-1"><span class="header-section-number">5.2</span> Un exercice</h2>
<ol type="1">
<li>Importer le data-frame contenu dans le fichier <strong>tauxchomage.csv</strong> disponible sur Connect <em>(à télécharger, et à placer dans le bon répertoire)</em>.</li>
<li>Ce fichier contient les taux de chômage par département en 2001, 2006 et 2011. A l’aide de la fonction <code>pivot_longer()</code>, créer un objet <code>taux_chomage_long</code> avec une colonne contenant tous les taux de chômage, et une colonne précisant les années pour chaque département.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>taux_chomage <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"tauxchomage.csv"</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sep=</span><span class="st">";"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>taux_chomage_long <span class="ot">&lt;-</span> taux_chomage <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"TCHOM"</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Année"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Taux_Chômage"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Année<span class="ot">=</span> <span class="fu">fct_recode</span>(Année,          <span class="co"># Recodage de la variable Année pour plus de lisibilité</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"2001"</span><span class="ot">=</span><span class="st">"TCHOMB1T01"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"2006"</span><span class="ot">=</span><span class="st">"TCHOMB1T06"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"2011"</span><span class="ot">=</span><span class="st">"TCHOMB1T11"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="traitement-des-données-manquantes" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Traitement des données manquantes</h1>
<p>Il arrive parfois que certaines données soient manquantes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Nom =</span> <span class="fu">c</span>(<span class="st">"Alain"</span>, <span class="st">"Alain"</span>, <span class="st">"Benoît"</span>, <span class="st">"Claire"</span>),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">Discipline =</span> <span class="fu">c</span>(<span class="st">"Maths"</span>, <span class="st">"Francais"</span>, <span class="st">"Maths"</span>, <span class="st">"Francais"</span>),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">Note =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">9</span>, <span class="dv">17</span>, <span class="dv">11</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">Present =</span> <span class="fu">rep</span>(<span class="st">"oui"</span>, <span class="dv">4</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>notes</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  Nom    Discipline  Note Present
  &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;  
1 Alain  Maths         16 oui    
2 Alain  Francais       9 oui    
3 Benoît Maths         17 oui    
4 Claire Francais      11 oui    </code></pre>
</div>
</div>
<p>Ici par exemple, Benoît n’a pas de note en Français.</p>
<section id="compléter-un-data-frame-avec-complete" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="compléter-un-data-frame-avec-complete"><span class="header-section-number">6.1</span> Compléter un data-frame avec <code>complete()</code></h2>
<p>On peut vouloir compléter les données de manière à ce que chaque couple <em>Nom/Discipline</em> ait une note.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> notes <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(Nom,Discipline)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La valeur d’attribtution par défaut est alors <code>NA</code>, mais on peut choisir ces valeurs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> notes <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(Nom,Discipline,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Note=</span><span class="dv">0</span>,<span class="at">Present=</span><span class="st">"non"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remplacer-les-na-avec-replace_na" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="remplacer-les-na-avec-replace_na"><span class="header-section-number">6.2</span> Remplacer les <code>NA</code> avec <code>replace_na()</code></h2>
<p>Considérons le tableau suivant qui possède des données manquantes, codées comme <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>donnees_na <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Groupe =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">Nom =</span> <span class="fu">c</span>(<span class="st">"Al"</span>, <span class="st">"Bob"</span>, <span class="cn">NA</span>, <span class="st">"Dave"</span>, <span class="st">"Elle"</span>, <span class="st">"Fanch"</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">Note =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>donnees_na</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Groupe Nom    Note
  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
1 A      Al     NA  
2 A      Bob     8  
3 A      &lt;NA&gt;    7  
4 B      Dave    4.5
5 B      Elle    1  
6 B      Fanch   4  </code></pre>
</div>
</div>
<p>On peut utiliser la fonction <code>replace_na()</code>pour remplacer les données manquantes par les valeurs souhaitées.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>donnees_na1 <span class="ot">&lt;-</span> donnees_na <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="at">replace =</span> <span class="fu">list</span>(<span class="at">Nom =</span> <span class="st">"Inconnu"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Note=</span><span class="dv">0</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>donnees_na1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Groupe Nom      Note
  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
1 A      Al        0  
2 A      Bob       8  
3 A      Inconnu   7  
4 B      Dave      4.5
5 B      Elle      1  
6 B      Fanch     4  </code></pre>
</div>
</div>
<p>Il est à noter que la fonction <code>replace_na()</code> peut servir pour remplacer les <code>NA</code> d’une colonne spécifique. Pour les des valeurs numériques, il est assez courant de remplacer les valeurs manquantes par la moyenne de la colonne.</p>
<p>Reprenons l’exemple précédent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>donnees_na2 <span class="ot">&lt;-</span> donnees_na <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nom=</span><span class="fu">replace_na</span>(Nom,<span class="at">replace=</span><span class="st">"Inconnu"</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Note=</span><span class="fu">replace_na</span>(Note,<span class="at">replace =</span> <span class="fu">mean</span>(Note,<span class="at">na.rm=</span><span class="cn">TRUE</span>))) </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On retire ici les valeurs NA pour calculer la moyenne</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>donnees_na2</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Groupe Nom      Note
  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
1 A      Al        4.9
2 A      Bob       8  
3 A      Inconnu   7  
4 B      Dave      4.5
5 B      Elle      1  
6 B      Fanch     4  </code></pre>
</div>
</div>
</section>
</section>
<section id="exercices" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Exercices</h1>
<section id="exercice-1" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="exercice-1"><span class="header-section-number">7.1</span> Exercice 1</h2>
<p><strong><em>Remarque :</em></strong> Dans la mesure du possible, on s’efforcera d’effectuer l’ensemble des manipulations ci-dessous via un seul canal d’instructions <em>(pipe)</em>.</p>
<ol type="1">
<li>Importer le data-frame contenu dans le fichier <strong>birds_scandinavia.csv</strong> disponible sur Connect. Ce jeu de données provient de l’article <em>Species composition and population fluctuations of alpine bird communities during 38 years in the scandinavian mountain range</em> de S. Svensson (2006). Dans cette étude, on compte le nombre d’oiseaux migrateurs revenant chaque année à certaines locations.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"birds_scandinavia.csv"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Modifier le data-frame afin qu’il contienne uniquement l’année, le nombre d’oiseaux comptés, le nom de l’espèce, la latitude et la longitude des observations. On renommera l’espèce par <code>SPECIES == GENUS_SPECIES</code>, et avec la fonction <code>arrange()</code>, on triera le data-frame en fonction des années.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> birds <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(YEAR,ABUNDANCE,GENUS_SPECIES,LATITUDE,LONGITUDE) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SPECIES=</span>GENUS_SPECIES) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(YEAR)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Certaines espèces peuvent être aperçues à différents endroits. Modifier la colonne <em>ABUNDANCE</em> afin qu’elle contienne uniquement le nombre total d’individus observé par année pour chaque espèce.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> birds <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR,SPECIES) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ABUNDANCE=</span><span class="fu">sum</span>(ABUNDANCE)) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Pour chaque année, créer une colonne <em>TOTAL_ABUNDANCE</em> donnant le nombre total d’oiseaux observés.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> birds <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TOTAL_ABUNDANCE =</span> <span class="fu">sum</span>(ABUNDANCE)) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>Créer ensuite une colonne <em>ABUNDANCE_REL</em> donnant par année l’<strong>abondance relative</strong> de chaque espèce, i.e.&nbsp;le pourcentage de chaque espèce dans la population totale <em>(on arrondira à 2 chiffres après la virgule)</em>.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> birds <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ABUNDANCE_REL=</span>ABUNDANCE<span class="sc">/</span>TOTAL_ABUNDANCE) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ABUNDANCE_REL=</span><span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>ABUNDANCE_REL,<span class="dv">2</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="6" type="1">
<li>Dans un obet <code>birds_summary</code>, donner pour chaque espèce le nombre moyen d’oiseaux observés chaque année, ainsi que l’abondance relative moyenne. On triera ce jeu de données en fonction de l’abondance relative, dans un ordre décroissant.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>birds_summary <span class="ot">&lt;-</span> birds <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SPECIES) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ABUNDANCE_REL =</span> <span class="fu">mean</span>(ABUNDANCE_REL),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">MEAN_ABUNDANCE =</span> <span class="fu">mean</span>(ABUNDANCE)) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercice-2" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="exercice-2"><span class="header-section-number">7.2</span> Exercice 2</h2>
<p><strong><em>Remarque :</em></strong> Dans la mesure du possible, on s’efforcera d’effectuer l’ensemble des manipulations ci-dessous via un seul canal d’instructions <em>(pipe)</em>.</p>
<ol type="1">
<li>Importer le data-frame contenu dans le fichier <strong>cirrhosis.csv</strong> disponible sur Connect. Il est également disponible sur <a href="https://archive.ics.uci.edu/dataset/878/cirrhosis+patient+survival+prediction+dataset-1" target="_blank"> cette page </a> <em>(Source : Fleming, Thomas R., and David P. Harrington. Counting processes and survival analysis. Vol. 625. John Wiley &amp; Sons, 2013)</em>, où l’on trouvera une description des variables d’intérêt.</li>
</ol>
<p>De façon générale, ce jeu de données recense des informations médicales sur 418 patients souffrant d’une cirrhose, ayant reçu un traitement expérimental, un placebo, ou n’ayant rien reçu.</p>
<p>Combien de valeurs manquantes le data-frame compte-t-il ?</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cirr <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"cirrhosis.csv"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(cirr)) <span class="co">#Il y a 1033 valeurs manquantes</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li><p>A l’aide des fonctions <code>mutate()</code>et <code>mutate_if()</code>, transformer toutes les colonnes nécessaires en facteurs, ainsi que la colonne <em>Stage</em>.</p></li>
<li><p>Remplacer les valeurs manquantes de la colonne <em>Drug</em> par la valeur <code>"None"</code>. <em>On pourra utiliser la fonction <code>fct_na_value_to_level()</code></em>.</p></li>
<li><p>Remplacer toutes les valeurs manquantes des autres variables catégorielles <em>(i.e.&nbsp;facteurs)</em> par <code>"Unknown"</code>.</p></li>
<li><p>Efectuer un résumé statistique du data-frame.</p></li>
</ol>
<p>Afin d’éviter de compter des valeurs <code>Unknown</code> dans les variables n’en présentant aucune <em>(par exemple <code>Drug</code>)</em>, on re-transformera en facteurs toutes les variables catégorielles.</p>
<p>Effectuer à nouveau un résumé statistique du data-frame, et comparer avec le résumé précédent.</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cirr <span class="ot">&lt;-</span> cirr <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Stage=</span><span class="fu">as.factor</span>(Stage)) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(<span class="at">.predicate =</span> is.character,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.funs =</span> as.factor) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Drug =</span> <span class="fu">fct_na_value_to_level</span>(Drug,<span class="at">level=</span><span class="st">"None"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(<span class="at">.predicate =</span> is.factor,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.funs =</span> fct_na_value_to_level,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">level =</span> <span class="st">"Unknown"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(<span class="at">.predicate =</span> is.factor,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">.funs=</span>factor) </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cirr)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="6" type="1">
<li>Remplacer ensuite les valeurs manquantes des variables numériques par les moyennes de ces variables <em>(plus difficile, chercher des solutions sur le web si nécessaire)</em>.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>cirr <span class="ot">&lt;-</span> cirr <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(<span class="at">.predicate =</span> is.numeric, <span class="co"># On force ici la conversion des entiers en réels</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">.funs=</span>as.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(<span class="at">.predicate =</span> is.numeric,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.funs =</span> <span class="sc">~</span><span class="fu">replace_na</span>(.x,<span class="fu">mean</span>(.x,<span class="at">na.rm=</span><span class="cn">TRUE</span>)))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="7" type="1">
<li>Vérifier que le data-frame ne contient plus aucune valeur manquante.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(cirr))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="8" type="1">
<li>Créer un data-frame donnant les moyennes de la concentration en Bilirubine, ainsi que la quantité quotidienne moyenne de cuivre dans les urines pour chaque type de traitement et chaque stade de la maladie.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cirr_summary <span class="ot">&lt;-</span> cirr <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Drug,Stage) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean_Bilirubin =</span> <span class="fu">mean</span>(Bilirubin),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">Mean_Copper =</span> <span class="fu">mean</span>(Copper)) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="9" type="1">
<li>Commenter les effets du traitement proposé sur ces valeurs.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cirr <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Stage<span class="sc">==</span><span class="st">"1"</span> <span class="sc">&amp;</span> Drug <span class="sc">==</span> <span class="st">"D-penicillamine"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>cirr <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Stage<span class="sc">==</span><span class="st">"1"</span> <span class="sc">&amp;</span> Drug <span class="sc">==</span> <span class="st">"Placebo"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Commentaire
</summary>
<p><em>L’effect du traitement n’est pas clair. Sur les stades très avancés ou très peu avancés, les patients suivant le traitement ant des analyses moins bonnes. En revanche, les résultats sont meilleurs pour les stades “moyens” 2 et 3. Il convient ici de préciser que les échantillons sont très faibles pour le stade 1. Les résultats sont donc peu fiables</em></p>
</details>
</section>
<section id="exercice-3" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="exercice-3"><span class="header-section-number">7.3</span> Exercice 3</h2>
<p>Les données sont ici inspirées de l’article <em>Differences in soil properties among contrasting soil types in northern Borneo</em>, de G. Sellan et al (2020). Elles ont été modifiées à des fins pédagogiques, et ne représentent donc pas de réalité biologique dans le cadre de cet exercice.</p>
<p>On s’intéresse ici aux caractéristiques physico-chimiques de sols tropicaux à Bornéo. On a mesuré, sur 180 sites, en 3 profondeurs différentes, des caractéristiques chimiques sur 539 échantillons (<span class="math inline">\(180 \times 3\)</span>, auquels se soustrait une mesure manquante). Les 18 caractéristiques mesurées sont les suivantes:</p>
<ul>
<li>Teneurs en sodium, Magnésium, Calcium, Potassium échangeables (<code>Exc.Na</code>, <code>Exc.Mg</code>, <code>Exc.Ca</code>, <code>Exc.K</code>)</li>
<li>Teneur en eau (colonne <code>MC</code>),</li>
<li>Phosphore <code>P</code>, Carbone <code>C</code> et Azote <code>N</code>, <code>pH</code> et Aluminium et Acidité échangeable <code>Exc.Al</code>, <code>Exc.Ac</code>, Saturation en bases(<code>BS</code>)</li>
<li>Effective Cation Exchange Capacity (<code>ECEC</code>)</li>
<li>Nitrates <code>NO3</code>, Ammonium <code>NH4</code></li>
<li>Pourcentage d’argile <code>Clay</code>, de limon <code>Silt</code> et de sable <code>Sand</code>.</li>
</ul>
<p>En plus de ces caractéristiques, on connaît le type de sol (dans la colonne <code>Soil</code>), qui est soit Alluvial, Dunaire <em>(heath)</em>, ou Grès <em>(sandstone)</em>), ainsi que la profondeur à laquelle a été faite le prélèvement (colonne <code>Depth</code>, à 0-5cm, 5-20 cm ou 25-30 cm).</p>
<p>En plus des ces colonnes sont enregistrées les noms des sites sur lesquels on a échantillonné les sols. Toutes les informations sont regroupées dans les colonnes <code>Plot</code>, <code>Subplot</code>, <code>Block</code>, <code>Name1</code>, <code>Name</code> et <code>Names2</code>.</p>
<p>Ces données sont disponibles sur Connect dans le fichier <code>donnees_sols_chimie.csv</code>.</p>
<ol type="1">
<li>Importer ce jeu de données sous le nom <code>sol_initial</code>.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sol_initial <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"donnees_sols_chimie.csv"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Parallèlement à cela, on dispose de l’abondance de 21 espèces d’arbres sur nos sites dans le fichier <code>donnees_abondance.csv</code>, disponible sur Connect. Dans ce tableau de 900 lignes et 21 colonnes, chaque ligne est donc associée à un site, dont le nom est renseigné dans la colonne <code>Name</code>. Les colonnes restantes correspondent aux 20 espèces. Pour un site et une espèce donnés, on a renseigné dans le tableau le nombre d’individus recensés.</li>
</ol>
<p>Importer ce jeu de données sous le nom <code>abondance_initial</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>abondance_initial <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"donnees_abondance.csv"</span>,<span class="at">row.names =</span> <span class="dv">1</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>A partir du jeu de données <code>sol_initial</code>. Effectuer les nettoyages suivants:</li>
</ol>
<!-- -->
<ol type="a">
<li>Se débarrasser des colonnes <code>Plot</code>, <code>Subplot</code>, <code>Block</code>, <code>Name1</code>, et <code>Names2</code>.</li>
<li>Renommer les colonnes (en utilisant la fonction <code>rename</code>):</li>
</ol>
<ul>
<li><code>MC</code> en <code>Eau</code></li>
<li><code>ECEC</code> en <code>Exc.Cations</code></li>
<li><code>Soil</code> en <code>Sol</code></li>
<li><code>Name</code> en <code>Site</code></li>
<li><code>Depth</code> en <code>Profondeur</code></li>
<li><code>BS</code> en <code>SatBase</code></li>
<li><code>Clay</code> en <code>Argile</code></li>
<li><code>Silt</code> en <code>Limon</code></li>
<li><code>Sand</code> en <code>Sable</code></li>
</ul>
<ol start="3" type="a">
<li>Transformer la nouvelle colonne <code>Sol</code> en facteur pour que les niveaux soient en Français, dans cet ordre (Alluvial, Grès <em>(Sandstone)</em> et Dunaire <em>(Heath)</em>).</li>
<li>Transformer la colonne Profondeur en facteur pour que les niveaux soient dans l’ordre “0-5 cm”, “5-20 cm”, “20-35 cm”.</li>
</ol>
<p>Le résultat sera stocké dans un objet <code>sol_avec_na</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>sol_avec_na <span class="ot">&lt;-</span> sol_initial <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Plot,Subplot,Block,Name1,Names2)) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Eau =</span> MC,<span class="at">Exc.Cations =</span> ECEC,<span class="at">Sol=</span>Soil,<span class="at">Site=</span>Name,<span class="at">Profondeur=</span>Depth,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">SatBase=</span>BS,<span class="at">Argile=</span>Clay,<span class="at">Limon=</span>Silt,<span class="at">Sable=</span>Sand) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sol=</span><span class="fu">factor</span>(Sol,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Alluvial"</span>,<span class="st">"Sandstone"</span>,<span class="st">"Heath"</span>),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Alluvial"</span>,<span class="st">"Grès"</span>,<span class="st">"Dunaire"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Profondeur=</span><span class="fu">as.factor</span>(Profondeur))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Il existe des valeurs manquantes dans les colonnes <code>pH</code> et <code>Av.P</code>. Pour les lignes correspondantes, seules ces informations manquent. Afin d’éviter de supprimer la ligne entière (et donc toutes les autres mesures pour ce site), remplacer dans <code>sol_avec_na</code> chaque valeur manquante par la moyenne de sa quantité, pour le type de sol correspondant.</li>
</ol>
<p>Stocker le résultat dans un objet <code>sol_propre</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sol_propre <span class="ot">&lt;-</span> sol_avec_na <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sol) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pH=</span><span class="fu">replace_na</span>(pH,<span class="fu">mean</span>(pH,<span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Av.P=</span><span class="fu">replace_na</span>(Av.P,<span class="fu">mean</span>(Av.P,<span class="at">na.rm=</span><span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>On veut maintenant créer un tableau où il y a une seule ligne par site, afin de le joindre avec la table des abondances. Pour cela, plusieurs options s’offrent à nous:</li>
</ol>
<ul>
<li>Option <strong>choix d’une profondeur</strong>: avec la fonction <code>filter()</code>, stocker dans un tableau <code>sol_superficiel</code> le tableau ne comprenant que la profondeur 0-5 cm. Dans ce tableau, on aura supprimé la colonne <code>Profondeur</code> (avec <code>select(-Profondeur)</code>).</li>
<li>Option <strong>moyenne</strong>: avec les fonctions <code>group_by()</code> et <code>summarise_if()</code>, créer un tableau <code>sol_moyen</code> où chaque ligne est la moyenne (pour les colonnes numériques) des caractéristiques par site.</li>
</ul>
<p>Créer ces deux tableaux à partir de <code>sol_propre</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>sol_superficiel <span class="ot">&lt;-</span> sol_propre <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Profondeur<span class="sc">==</span><span class="st">"0-5 cm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Profondeur)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>sol_moyen <span class="ot">&lt;-</span> sol_propre <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Site) <span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_if</span>(<span class="at">.predicate =</span> is.numeric,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">.funs =</span> mean) <span class="sc">%&gt;%</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="6" type="1">
<li>A partir du jeu de données <code>abondance_initial</code>, effectuer les nettoyages suivants, et stocker le résultat dans un jeu de données <code>abondance_propre</code>:</li>
</ol>
<!-- -->
<ol type="a">
<li>Renommer La colonne <code>Name</code> en <code>Site</code>.</li>
<li>Cette colonne <code>Site</code> contient le nom des sites, qui est commun avec le tableau <code>sol_propre</code> traité dans la partie précédente. Malheureusement, ici, la lettre finale est séparée des chiffres par un espace au lieu d’un <code>_</code>. Modifier cette colonne <code>Site</code> en remplaçant les espaces par des <code>_</code> (on utilisera la fonction <code>str_replace()</code>).</li>
</ol>
<!-- -->
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>abondance_propre <span class="ot">&lt;-</span> abondance_initial <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Site =</span> Name) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Site=</span><span class="fu">str_replace</span>(Site,<span class="at">pattern =</span> <span class="st">" "</span>,<span class="at">replacement =</span> <span class="st">"_"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="7" type="1">
<li>A l’aide la fonction <code>pivot_longer()</code>, transformer <code>abondance_propre</code> en un tableau au format long (que l’on nommera <code>abondance_long</code>), c’est à dire comportant 3 colonnes:</li>
</ol>
<ul>
<li>La colonne <code>Site</code>.</li>
<li>Une nouvelle colonne <code>Espece</code> qui contiendra le noms de toutes les espèces présentes auparavant.</li>
<li>Une nouvelle colonne <code>NbIndividus</code> qui contiendra, pour un site et une espèce donnée, le nombre d’individus correspondant.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>abondance_long <span class="ot">&lt;-</span> abondance_propre <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>Site,<span class="at">names_to =</span> <span class="st">"Espece"</span>,<span class="at">values_to =</span> <span class="st">"NbIndividus"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="8" type="1">
<li>A partir du tableau <code>abondance_long</code>, créer le tableau <code>richesse_par_site</code> de la manière suivante.</li>
</ol>
<ul>
<li>Sélectionner simplement les lignes où le nombre d’individus comptés est supérieur à 0.</li>
<li>De cette sélection, compter pour chaque site la densité d’arbres sur ce site, à savoir le nombre d’individus total (toutes espèces confondues), divisé par 400 (<span class="math inline">\(\mathrm{m}^2\)</span>), la surface de chaque site. Cette information sera stockée dans une colonne <code>densite_arbre</code>. De plus, on veut compter le nombre d’espèces recensées pour lesquelles on a compté au moins un individu (dans une colonne <code>richesse_specifique</code>).</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>richesse_par_site <span class="ot">&lt;-</span> abondance_long <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NbIndividus <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Site) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">densite_arbres =</span> <span class="fu">sum</span>(NbIndividus)<span class="sc">/</span><span class="dv">400</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">richesse_specifique =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="9" type="1">
<li>Créer un tableau <code>donnees_richesses</code> qui, pour chaque site présent à la fois dans <code>richesse_par_site</code> et <code>sol_superficiel</code>, donne toutes les caractéristiques du site.</li>
</ol>
<p>Faire cette jointure à l’aide des fonctions <code>left_join()</code> et <code>inner_join()</code>. Quelle jointure doit on garder? Stocker le résultat dans <code>donnees_richesses</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees_richesse &lt;- left_join(richesse_par_site,sol_superficiel)</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>donnees_richesse <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(richesse_par_site,sol_superficiel)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Commentaire
</summary>
<ul>
<li>On doit garder le <code>inner_join()</code>.<code>left_join()</code> conserve tous les sites de <code>richesse_par_site</code>, même ceux qui n’étaient pas présents dans <code>sol_superficiel</code> (on a donc trop de sites et plein de <code>NA</code>…). <code>inner_join()</code> conserve uniquement les sites présents dans les 2 tableaux.</li>
</ul>
</details>
<ol start="10" type="1">
<li>A l’aide de la fonction <code>save()</code>, enregistrer les tableaux crées précédemment dans un fichier <em>Borneo.Rdata</em>. <strong>Ces données seront réutilisées dans le prochain TD</strong>.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Voir la correction</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees_richesse &lt;- left_join(richesse_par_site,sol_superficiel)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(sol_propre,sol_superficiel,sol_moyen,abondance_propre,abondance_long,richesse_par_site,donnees_richesse,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="st">"Borneo.Rdata"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>